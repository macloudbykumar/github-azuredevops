name: Install Jenkins on CentOS 9

on:
  workflow_dispatch:

jobs:
  install_jenkins:
    runs-on: self-hosted  # your CentOS 9 self-hosted GitHub Actions runner

    steps:

      - name: Install Java 17
        run: |
          dnf install -y java-17-openjdk java-17-openjdk-devel
          java -version

      - name: Add Jenkins repo and key
        run: |
          dnf install -y wget
          wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
          rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

      - name: Install Jenkins
        run: |
          dnf install -y jenkins

      - name: Enable and start Jenkins
        run: |
          systemctl enable --now jenkins
          systemctl status jenkins --no-pager

      - name: Open firewall for Jenkins (port 8080)
        run: |
          firewall-cmd --permanent --add-port=8080/tcp || true
          firewall-cmd --reload || true

      - name: Show Jenkins initial admin password
        run: |
          echo "Initial admin password (save this):"
          cat /var/lib/jenkins/secrets/initialAdminPassword || echo "‚ùó Jenkins not fully initialized yet"
